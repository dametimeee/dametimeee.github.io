---
title: 세션, 토큰, 쿠키(JWT)
date: 2023-02-28 13:49
categories: [CS]
tags: [세션, 토큰, 쿠키, session, token, JWT, CS]
sitemap:
  changefreq: daily
  priority: 1.0
---

## 쿠키(Cookie)

쿠키를 이용해서 서버는 브라우저에 데이터를 넣을 수 있다. 사이트에 방문하면, 브라우저는 서버에 요청을 보낸다. <br>서버는 이에 응답하는데 응답에는 모든 데이터와 페이지정보, 브라우저에 저장하고자 하는 쿠키가 있을 수 있다.<br><br> 브라우저에 쿠키를 저장한 후 해당 웹사이트에 방문할 때마다 브라우저는 해당 쿠키도 요청과 함께 보내게 된다.<br> 참고로 쿠키는 도메인에 따라 제한된다. 유튜브가 준 쿠키는 유튜브에만 보내지게 된다. 쿠키는 만료 시간이 있다.<br> 하루, 한달 등 서버가 정한 기간에 따라 유효하다.<br><br> 쿠키는 인증 뿐만 아니라 여러가지 정보를 저장할 수 있다.<br><br>예를 들면, 웹사이트 언어 설정을 영어에서 한국어로 바꾸면 브라우저는 서버에 언어 변경 요청을 보내고 서버는 응답으로<br> 쿠키를 보낸 후, 언어를 한국어로 저장한다. 다시 동일한 웹사이트에 방문하였을 경우, 쿠키는 요청과 함께 서버로 보내지고 <br>서버는 한국어 버전의 페이지를 제공한다.

## 세션, 토큰에 들어가기 전에

세션과 토큰이 왜 필요한지 이해하려면
HTTP(웹사이트를 이용할 때 쓰는 프로토콜)은 Stateless(무상태) 다.<br><br> Stateless란, 서버로 가는 모든 요청이 이전 요청과 독립적을 다뤄진다는 뜻이다. 요청끼리 연결이 없다. 요청들은 메모리를 갖고 있지 않다. 요청이 끝나면, 서버는 내가 누군지 잊어버린다. 그렇기 때문에 요청할 때마다 내가 누군지 알려줘야 한다.<br><br> 이를 하는 방법이 세션(Session)과 토큰(Token)이다.

## 세션(Session)

![image](https://user-images.githubusercontent.com/106083871/221753323-15473b3d-4d98-4463-8185-502b6923d1b2.png)

'dametimeee' 이라는 유저명이 있고, 로그인 하고 싶다면, 유저명 그리고 비밀번호를 서버에 보낸다.<br> 비밀번호가 맞다면, 서버는 세션DB에 'dametimeee' 이라는 유저를 생성한다. 해당 세션에는 별도의 ID가 있다.<br><br>
그 ID는 쿠키를 통해 브라우저로 돌아오고 저장된다.<br> 따라서 같은 웹사이트의 다른 페이지로 이동하면 브라우저는 세션ID를 갖고 있는 쿠키를 서버에 보낸다.<br><br> 그냥 쿠키는 자동으로 보내진다. 서버는 들어오는 쿠키를 보고, 세션ID와 함께 오는 쿠키를 확인한다.<br> 아직까지 서버는 내가 누군지 모른다.
그저 세션ID가 있는 쿠키를 지닌 요청이 있다는 것만 알 뿐이다.<br><br> 해당 세션ID를 가지고 세션DB를 확인할 것이고, 거기서 해당 ID는 유저명 'dametimeee' 의 것이라는 걸 알게 되고, 바로 그제서야 서버는 내가 누구인지 알게 되고 로그인 될 것이다. 해당 요청이 끝나고 다른 페이지에 가더라도 동일한 프로세스가 반복된다.<br><br>
기억해야 할 내용은 중요한 유저 정보는 모두 서버에 있다는 것이다.<br><br> 유저가 갖고 있는 것은 세션ID 뿐이다. 쿠키는 그저 세션ID를 전달하기 위한 매개체일 뿐이다. 세션을 이용해서 iOS, Android 앱을 만들 수 있지만, 쿠키는 사용할 수 없다. 쿠키는 브라우저에만 있다. 네이티브 앱에는 없다.<br><br> 바로 이 경우 토큰을 이용한다.

## 토큰(Token)

토큰은 이상하게 생긴 string이다.<br><br> 해당 토큰을 서버에 보내고 서버는 세션DB에서 해당 토큰과 일치하는 유저를 찾는다.<br> 세션에 대해서 기억해야 할 것은 현재 로그인한 유저들의 모든 세션ID를 DB에 저장해야 한다는 것이다.<br><br> 즉, 요청이 들어올 때마다 서버는 쿠키를 받아서 세션ID를 보고 해당 ID와 일치하는 유저를 찾고 나서 다음 작업을 수행할 수 있다. 요청이 있을 때마다 DB를 찾아야 한다는 것이다. 유저가 늘어남에 따라 DB 리소스가 더 필요한 것이다.<br><br> 이 때 JWT가 등장한다.

## JWT(Json Web Token)

![image](https://user-images.githubusercontent.com/106083871/221753874-ee53d147-e657-4ee6-8a68-b819946d7ba3.png)

JWT는 토큰 형식이다.<br><br> JWT로 유저 인증을 처리하면 세션DB가 필요없고
서버는 유저 인증 한다고 많은 일을 하지 않아도 된다. <br>위에서 언급한 것처럼 토큰은 이상하게 생긴 텍스트다. 서버에서 받아서 요청할 때마다 보내야 하는 것이다.<br><br>로그인 예시를 통해 세션과 JWT의 차이점을 알아보자.

로그인 하려면 유저명, 비밀번호를 서버에 보내고 일치한다면 서버는 DB에 뭔가를 생성하지 않는다. <br>대신 서버는 유저ID를 가져다가 사인 알고리즘을 이용해 '사인'을 한다. 그리고 해당 '사인된 정보'를 string 형태로 보낸다.

JWT는 이렇게 생겼다.
![image](https://user-images.githubusercontent.com/106083871/221762635-adc0cffb-4515-49f2-aa04-9f2a9490c1d8.png)
<br>
보통 세션ID보다 훨씬 길다.<br> 쿠키는 또한 공간 제약이 있다. 그러나 JWT는 제약이 없어서 상관없다. 상상 이상으로 길어도 된다.<br> 세션과 동일하게 로그인 했지만 차이점은 DB를 건드리는 대신, 정보를 사인하고 전달하는 것이 끝이다.

서버에 요청을 보내려면, 세션ID와 비슷하게 해당 '사인된 정보' 또는 토큰을 서버에 보내야 한다.<br> 서버는 토큰을 받으면, 해당 사인이 유효한지 체크하는데 이는 토큰을 조작 했는지 체크하는 것이다.<br> 토큰이 유효하다면, 서버는 유저로 인증한다. <br><br>바로 이것이 세션과 JWT의 가장 큰 차이점이다.

세션은 세션ID만 보내면 된다. 세션에 대한 모든 정보는 세션DB에 저장되어 있다.<br> 페이지를 요청하면 서버는 세션ID를 DB에서 찾으면 된다.

JWT에선 서버는 유저를 인증하는데 필요한 정보를 토큰에 저장한다.
그리고 해당 토큰을 나에게 준다.<br> 페이지를 요청하면 서버는 해당 토큰이 유효한지만 검증하면 된다. DB를 거칠 필요 없이.<br><br> 단점은 JWT는 암호화 되지 않았다. '암호화' 되었다면 아무도 읽을 수 없고 이해할 수 없다.<br> '암호화' 되지 않았기 때문에 누구나 열어서 해당 컨텐츠를 볼 수 있다. 그래서 비밀정보를 JWT 안에 둬서는 안된다.

## 세션, JWT 장단점

**Session**

- 장점
  - 서버가 로그인 된 유저의 모든 정보를 저장하기 때문에, 해당 정보를 이용하면 새로운 기능들을 추가할 수 있게 된다.(원하지 않는 디바이스 로그아웃, 넷플릭스 계정 공유 숫자 제한)
- 단점
  - DB 유지보수가 필수적이고 유저가 늘어나면 DB도 커져야 하기 때문에 가격이 올라간다.

**JWT**

- 장점

  - DB가 필요없다.(QR 체크인)
  - 서버가 이중 삼중 여러대 일 때 강점을 가진다.<br> 세션의 경우 로드밸런싱으로 유저가 처음 방문했을 때는 1번 서버로 방문하여 세션이 남아 있지만,<br> 두 번째 방문했을 때, 1번이 아닌 2번으로 붙게되면 세션정보가 없어 인증 실패하게 된다. (redis 세션통합으로 개발하거나, 서버에 상관없는 jwt로 인증을 구현한다.)

- 단점
  - 해당 토큰이 만료되기 전까지는 유효하기 때문에, 강제 로그아웃 같은 세션 기능을 수행할 수 없다.

## 결론

JWT는 사용이 편리하고 무엇보다 DB없이 유저 인증을 할 수 있다는 장점이 너무나 크다.<br> 하지만 유저가 늘어나고 유저 정보를 더 잘 관리하기 위해서는 DB 또한 필수적이다.<br> 처음에는 JWT를 사용하고, 후에 세션으로 바꾸는 것이 괜찮은 방법이라고 생각한다.<br><br>

> 참고자료 <br> [노마드코더 유튜브 <세션 vs 토큰 vs 쿠키>](https://www.youtube.com/watch?v=tosLBcAX1vk)<br> [Kingth.log <서버 인증 방식(세션/쿠키, 토큰>)](https://velog.io/@kingth/%EC%84%9C%EB%B2%84-%EC%9D%B8%EC%A6%9D-%EB%B0%A9%EC%8B%9D%EC%84%B8%EC%85%98%EC%BF%A0%ED%82%A4-%ED%86%A0%ED%81%B0)<br> [chanyeong <Passport.js + JWT로 유저 인증하기>](https://chanyeong.com/blog/post/28)
